
@inject HttpClient Http

@if (visible)
{
<div>
    <EditForm Model=@pageModel OnValidSubmit="FormSubmitted" class="bl-email-form">
        <DataAnnotationsValidator />


        <div class="form-row">
            <div class="col-md-6 form-group">
                <InputText @bind-Value="pageModel.Name" class="form-control" placeholder="Your Name" />
                <ValidationMessage For="@(() => pageModel.Name)" />
            </div>
            <div class="col-md-6 form-group">
                <InputText @bind-Value="pageModel.EmailAddress" class="form-control" type="email" placeholder="Your Email" />
                <ValidationMessage For="@(() => pageModel.EmailAddress)" />
            </div>
        </div>
        <div class="form-group ">
            <InputText @bind-Value="pageModel.Subject" class="form-control" placeholder="Subject" />
            <ValidationMessage For="@(() => pageModel.Subject)" />
        </div>
        <div class="form-group">
            <InputTextArea @bind-Value="pageModel.Message" rows="5" style="min-width:100%" placeholder="Message"></InputTextArea>
            <ValidationMessage For="@(() => pageModel.Message)" />
        </div>
      <img  src="../img/capback.jpg"/>
        <div class="text-center "><button class="btn btn-info" type="submit" >Send Message</button></div>
    </EditForm>

</div>
}
else
{
<div class="bl-email-form">
    <p>Thank you for contacting me, I will reposnse as soon as possible</p>
</div>
}



@code {



        bool visible = true;

        ContactMessageModel pageModel;

    protected override void OnInitialized()
    {
        pageModel = new ContactMessageModel();
        base.OnInitialized();
    }

    async void FormSubmitted()
    {


        ContactMessage contactMessage = new ContactMessage()
        {
            Name = pageModel.Name,
            EmailAddress = pageModel.EmailAddress,
            Subject = pageModel.EmailAddress,
            Message = pageModel.Message
        };

        // !Replace with hosted address
        var result = await Http.PostAsJsonAsync("https://localhost:5002/api/mail", contactMessage);
        var success = result.StatusCode;

        if (result.StatusCode == System.Net.HttpStatusCode.OK)
        {
            visible = false;
            StateHasChanged();
        };




    }

}